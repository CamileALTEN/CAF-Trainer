############################################################
# CAF-Trainer • client • Dockerfile.dev (CRA + hot-reload)
############################################################
FROM node:20.11-alpine
WORKDIR /app
ENV NODE_ENV=development \
    CHOKIDAR_USEPOLLING=true \
    NODE_EXTRA_CA_CERTS=/usr/local/share/ca-certificates/corp-root-ca.crt

# ── Certificat proxy entreprise ───────────────────────────
COPY client/corp-root-ca.cer /usr/local/share/ca-certificates/corp-root-ca.crt
RUN echo "c50f12f5e54507bf68454e87e006640d500186fe45d6fd04feda548a241b6bd1  /usr/local/share/ca-certificates/corp-root-ca.crt" | sha256sum -c -
RUN cat /usr/local/share/ca-certificates/corp-root-ca.crt >> /etc/ssl/certs/ca-certificates.crt

# ── Dépendances du workspace « client » ───────────────────
COPY package*.json ./
COPY client/package*.json client/
RUN npm ci --workspaces --include-workspace-root=false --workspace client

# ── Code complet du front ─────────────────────────────────
COPY client ./client
WORKDIR /app/client

RUN addgroup -g 1001 app && adduser -D -G app -u 1001 app
USER app

# CRA lance automatiquement le serveur dev sur 3000
CMD ["npm", "start"]

EXPOSE 3000
